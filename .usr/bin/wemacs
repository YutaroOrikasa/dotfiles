#!/bin/bash

# public domain

# emacs on window system
# when window can not be opened, execute emacs on console

for arg in "$@";do
    if [[ "$arg" = -nw || "$arg" = --daemon ]];then
        command emacs "$@"
        return
    fi
done

if [ -n "$DISPLAY" ]; then
    IS_GRAPHICAL=true
else

    # On graphical mode, exit with success.
    # On terminal mode, emacs can't launch and exit with error code.
    if emacs -Q --eval='(kill-emacs)' </dev/null 2>/dev/null;then
        IS_GRAPHICAL=true
    fi
fi

if [ "$IS_GRAPHICAL" = true ]; then
    
    # "</dev/stdin" is workaround for carbon emacs
    # without this, carbon emacs will chdir to $HOME on launth
    emacs "$@" <&0 &
    disown emacs
else
    emacs "$@"
fi
